"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var l=t[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function formValidate(e){new validateForm(e)}function reloadFiles(e){var t=e.form,r=e.target,l=t.querySelectorAll('input[type="file"]'),i=!1,a="",n="";l[0].files[0]&&l[0].classList.remove("error");var s=document.createElement("label");l[0].getAttribute("data-role").includes("required")&&(i=!0);var o=l[l.length-1];r.nextElementSibling&&"LABEL"===r.nextElementSibling.tagName?(n=e.addText?e.addText:r.nextElementSibling.innerHTML,s=r.nextElementSibling,a=r.files[0].name,globalVars.inputFirst=!0):r.previousElementSibling&&"LABEL"===r.previousElementSibling.tagName?(s=r.previousElementSibling,n=e.addText?e.addText:r.previousElementSibling.innerHTML,globalVars.labelFirst=!0,a=r.files[0].name,o.files[0]=""):console.log("Structure error. Must be <input><label> or <label><input>"),s.innerHTML=a,globalVars.counter=++globalVars.counter;var u=l[0].getAttribute("id"),c=l[0].getAttribute("name"),b=document.createElement("input");b.setAttribute("name",c),b.setAttribute("type","file"),b.setAttribute("data-role","file");var m=b.getAttribute("name"),p=String(globalVars.counter)+m,f=(b.getAttribute("id"),String(globalVars.counter)+u);if(b.setAttribute("ID",f),b.setAttribute("name",p),globalVars.inputFirst&&globalVars.amountFiles<=e.limit){r.after(s),s.after(b);var g=document.createElement("label");if(g.innerHTML=n,g.setAttribute("for",f),b.after(g),globalVars.amountFiles=++globalVars.amountFiles,globalVars.amountFiles===e.limit){var d=t.querySelectorAll('input[type="file"]');d[d.length-1].setAttribute("disabled","")}}else if(globalVars.labelFirst&&globalVars.amountFiles<=e.limit){var h=document.createElement("label");if(h.setAttribute("for",f),h.innerHTML=n,r.after(h),r.nextElementSibling.after(b),globalVars.amountFiles=++globalVars.amountFiles,globalVars.amountFiles===e.limit){var v=t.querySelectorAll('input[type="file"]');v[v.length-1].setAttribute("disabled","")}}l.forEach(function(r){globalVars.inputsArray.includes(r)||(globalVars.inputsArray.push(r),r.addEventListener("click",function(a){globalVars.inputFirst&&a.target.files&&(a.preventDefault(),r.nextElementSibling&&r.nextElementSibling.remove(),delete r.files[0],r.remove(),globalVars.amountFiles=--globalVars.amountFiles,globalVars.amountFiles===e.limit?t.querySelectorAll('input[type="file"]')[t.querySelectorAll('input[type="file"]').length-1].setAttribute("disabled",""):t.querySelectorAll('input[type="file"]')[t.querySelectorAll('input[type="file"]').length-1].removeAttribute("disabled","")),globalVars.labelFirst&&a.target.files&&(globalVars.inputsArray.includes(r)||globalVars.inputsArray.push(r),a.preventDefault(),r.previousElementSibling&&r.previousElementSibling.remove(),delete r.files[0],r.remove(),globalVars.amountFiles=--globalVars.amountFiles,globalVars.amountFiles===e.limit?t.querySelectorAll('input[type="file"]')[t.querySelectorAll('input[type="file"]').length-1].setAttribute("disabled",""):t.querySelectorAll('input[type="file"]')[t.querySelectorAll('input[type="file"]').length-1].removeAttribute("disabled","")),1===l.length&&i&&t.querySelectorAll('input[type="file"]')[0].setAttribute("data-role","file required")}))})}var globalVars={counter:0,inputFirst:!1,labelFirst:!1,inputsArray:[],amountFiles:0},validateForm=function(){function e(t){_classCallCheck(this,e),this.form=t.form,this.length=t.form.children.length,this.errors=[],this.passwordRegExp=t.passwordRegEx||/^.{6,}$/,this.emailRegExp=t.emailRegExp||/^[-._a-zA-Z0-9]+@(?:[a-z0-9][-a-z0-9]+\.)+[a-z]{2,6}$/,this.phoneRegExp=t.phoneRegExp||/^(\s*)?(\+)?([- _():=+]?\d[- _():=+]?){6,14}(\s*)?$/,this.url=t.url,this.onLoadStart=function(){}||t.onLoadStart,this.onSuccess=function(){}||t.onSuccess,this.onError=function(){}||t.onError,this.errorClass=t.errorClass||"error",this.validation()}return _createClass(e,[{key:"validation",value:function(){var e=this;this.errors=[];for(var t=this.form.querySelectorAll("input"),r=0;r<t.length;r++)if("button"!==t[r].type&&"submit"!==t[r].type){var l=t[r].getAttribute("data-role").includes("required");l&&""===t[r].value||l&&t[r].getAttribute("data-role").includes("checkbox")&&!t[r].checked?this.errors.push(t[r]):t[r].getAttribute("data-role").includes("phone")?this.phoneValidation(t[r]):t[r].getAttribute("data-role").includes("email")?this.emailValidation(t[r]):t[r].getAttribute("data-role").includes("password")?this.passwordValidation(t[r]):t[r].classList.remove(this.errorClass)}if(this.errors.length)this.errors.forEach(function(t){return t.classList.add(e.errorClass),!1});else{var i=!1;t.forEach(function(e){return e.classList.contains("error")?(i=!0,!1):void 0}),i||this.sendInfo(this.url)}}},{key:"phoneValidation",value:function(e){return e.value.match(this.phoneRegExp)?(this.errors.pop(e),e.classList.remove(this.errorClass),!0):(this.errors.push(e),!1)}},{key:"emailValidation",value:function(e){return e.value.match(this.emailRegExp)?(this.errors.pop(e),e.classList.remove(this.errorClass),!0):(this.errors.push(e),!1)}},{key:"passwordValidation",value:function(e){return e.value.match(this.passwordRegExp)?(this.errors.pop(e),e.classList.remove(this.errorClass),!0):(this.errors.push(e),!1)}},{key:"cleanForm",value:function(){this.form.reset();for(var e=this.form.querySelector('input[type="file"]'),t=(e.cloneNode(!1),this.form.querySelectorAll('input[type="file"]')),r=(e.previousElementSibling,0);r<t.length-1;r++)globalVars.labelFirst?(t[r].previousElementSibling.remove(),t[r].remove()):(t[r].nextElementSibling.remove(),t[r].remove());this.form.querySelectorAll('input[type="file"]')[form.querySelectorAll('input[type="file"]').length-1].removeAttribute("disabled",""),globalVars.inputFirst&&(this.form.querySelectorAll('input[type="file"]').nextElementSibling.innerHTML=""),globalVars.inputsArray=[],globalVars.amountFiles=0,globalVars.counter=0}},{key:"sendInfo",value:function(e){var t=this,r=new FormData(this.form);this.form.querySelector('input[type="submit"]').setAttribute("disabled",""),this.onLoadStart(),fetch(e,{method:"post",body:r}).then(function(e){return e.json()}).then(function(){t.onSuccess(),t.cleanForm(),t.form.querySelector('input[type="submit"]').removeAttribute("disabled")})["catch"](function(e){t.onError(),console.log(e)})}}]),e}();